<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:include="layout/base :: page">
    <th:block th:fragment="title">permissão de pvs</th:block>
    <th:block th:fragment="content">
        <div class="row">
            <div class="col s3">
                <form method="get" th:action="@{/pv-permissions}">
                    <div class="input-field row">
                        <input id="pv-code" name="code" th:value="${code}" type="text" />
                        <label for="pv-code">número do estabelecimento (PV)</label>
                    </div>
                    <div class="input-field row">
                        <input id="email" name="email" type="text" th:value="${email}" />
                        <label for="email">e-mail de acesso</label>
                    </div>
                    <div class="input-field row">
                        <select id="acquirer" name="acquirer">
                          <option th:selected="${acquirer == acquirerItem}"
                            th:each="acquirerItem: ${acquirers}"
                            th:text="#{'option.acquirer.' + ${acquirerItem}}"
                            th:value="${acquirerItem}"></option>
                        </select>
                        <label for="acquirer">adquirente</label>
                    </div>
                    <div class="input-field row">
                        <button class="btn waves-effect waves-light" type="submit">buscar</button>
                    </div>
                </form>
            </div>
            <div class="col s9">
                <p th:text="${message}" th:unless="${message == null}"></p>
                <p th:unless="${pvPermissions.totalPages > 0}">nenhum resultado encontrado</p>
                <form th:action="@{/pv-permissions}" method="post">
                    <input type="hidden" name="_method" value="delete" />
                    <table id="pv-permissions-table" class="striped" th:unless="${pvPermissions.totalPages == 0}">
                        <thead>
                            <tr>
                                <th></th>
                                <th>e-mail</th>
                                <th>adquirente</th>
                                <th>código do PV</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="permission : ${pvPermissions}">
                                <td th:with="id=${permission.user.id + '-' + permission.pv.id}">
                                    <input th:attr="id=${id},value=${id}" type="checkbox" th:checked="${false}" class="filled-in" name="pvPermissionIds"/>
                                    <label th:attr="for=${id}"></label>
                                </td>
                                <td th:text="${permission.user.email}"></td>
                                <td th:text="#{'option.acquirer.' + ${permission.pv.acquirer}}"></td>
                                <td th:text="${permission.pv.code}"></td>
                                <td><div th:if="${permission.pv.isHeadquarter()}" class="chip">matriz</div></td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="input-field row">
                        <div class="col right">
                            <button id="submit-btn" class="btn waves-effect waves-light disabled" type="button">
                                remover permissões
                            </button>
                        </div>
                    </div>

                    <div class="row">
                        <ul class="pagination center" th:unless="${pvPermissions.totalPages == 0}">
                            <li th:class="${pvPermissions.isFirst()} ? 'disabled' : 'waves-effect'">
                              <a th:href="${pvPermissions.isFirst()} ? 'javascript:void(0);' : @{${'/'}(page=${pvPermissions.number-1}, size=${pvPermissions.size}, code=${code}, acquirer=${acquirer})}" class="material-icons">chevron_left</a>
                            </li>
                            <li th:each="pageNo : ${#numbers.sequence(0, pvPermissions.totalPages - 1)}" th:class="${pvPermissions.number eq pageNo} ? 'active' : 'waves-effect'">
                                <a th:href="@{${'/'}(page=${pageNo}, size=${pvPermissions.size}, code=${code}, acquirer=${acquirer})}">
                                    <span th:text="${pageNo+1}"></span>
                                </a>
                            </li>
                            <li th:class="${pvPermissions.isLast()} ? 'disabled' : 'waves-effect'">
                                <a th:href="${pvPermissions.isLast()} ? 'javascript:void(0);' : @{${'/'}(page=${pvPermissions.number+1}, size=${pvPermissions.size}, code=${code}, acquirer=${acquirer})}" class="material-icons">chevron_right</a>
                            </li>
                        </ul>
                    </div>
                    <!-- Modal Structure -->
                    <div id="modal-remove-pv-permissions" class="modal">
                        <a class="btn-flat right modal-close"><i class="material-icons">highlight_off</i></a>
                        <div class="modal-content">
                            <h4>confirmar lançamentos?</h4>
                        </div>
                        <div class="modal-footer">
                            <div class="col">
                                <button class="modal-action modal-close waves-effect waves-green grey darken-3 btn white-text cancel" type="button">não, cancelar seleção</button>
                            </div>
                            <div class="col">
                                <button class="modal-action waves-effect waves-green btn" type="submit">sim, remover permissões</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </th:block>
    <th:block th:fragment="scripts">
        <script type="application/javascript" th:src="@{/js/pv-permissions.js}"></script>
    </th:block>
</html>
